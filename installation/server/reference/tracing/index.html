<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.108.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/docs/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/docs/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/docs/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/docs/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/docs/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/docs/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/docs/favicons/android-96x196.png sizes=96x196><link rel=icon type=image/png href=/docs/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/docs/favicons/android-192x192.png sizes=192x192><title>Tracing | Vela</title><meta property="og:title" content="Tracing"><meta property="og:description" content="This section contains information on configuring OpenTelemetry instrumentation for the Vela server.
"><meta property="og:type" content="article"><meta property="og:url" content="https://go-vela.github.io/docs/installation/server/reference/tracing/"><meta property="article:section" content="installation"><meta property="article:modified_time" content="2024-10-02T11:16:05-05:00"><meta itemprop=name content="Tracing"><meta itemprop=description content="This section contains information on configuring OpenTelemetry instrumentation for the Vela server.
"><meta itemprop=dateModified content="2024-10-02T11:16:05-05:00"><meta itemprop=wordCount content="861"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Tracing"><meta name=twitter:description content="This section contains information on configuring OpenTelemetry instrumentation for the Vela server.
"><link rel=preload href=/docs/scss/main.min.7c14aac992e778334fff229c2f9317855b00afa05739d9101a7cc340cce611b7.css as=style><link href=/docs/scss/main.min.7c14aac992e778334fff229c2f9317855b00afa05739d9101a7cc340cce611b7.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><title>Tracing | Vela</title></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/docs/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" clip-rule="evenodd" viewBox="0 0 1920 1920"><path fill="#34c6f4" d="M618.73 431.74h-162.1a56.87 56.87.0 00-50.86 82.3l501.05 1002.1a56.86 56.86.0 00101.72.0l332.85-665.72 63.63 127.07-294.74 589.5a170.64 170.64.0 01-152.6 94.33 170.64 170.64.0 01-152.6-94.33L304.03 564.9A170.61 170.61.0 01456.63 318h105.14l56.96 113.75z"/><path fill="#34c6f4" d="M625.05 318h126.9l56.94 113.74h-126.9L625.05 318zm253.65.0h63.45l56.94 113.74h-63.44L878.7 318zM675.82 545.47l281.86 563.74 147.3-294.62 137.58-20.82-284.88 569.76-409.03-818.06h127.17z"/><path fill="#b957ce" d="m1372.75 659.05-234.4 35.44 168.8-166.43L1201.96 318l209.51 107.16 168.8-166.45-38.7 233.88 210.46 109.1-234.4 35.43-38.7 233.89-106.17-211.97z"/></svg></span><span class="text-uppercase font-weight-bold">Vela</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/community/><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/installation/><span class=active>Installation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/tour/><span>Tour</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/usage/><span>Usage</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/plugins/><span>Plugins</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/templates/><span>Templates</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/faq/><span>F.A.Q.</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/reference/><span>Reference</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><div><div class="search -navbar" id=search1><input id=search1input type=text placeholder="Search site..." v-model=txt @blur=close() maxlength=50><div class=search-results :style="{'display': showresult?'block':'none'}"><a v-for="item in result" :href=item.url>{{ item.display }}</a></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js integrity="sha512-PJa3oQSLWRB7wHZ7GQ/g+qyv6r4mbuhmiDb8BjSFZ8NZ2a42oTtAq5n0ucWAwcQDlikAtkub+tPVCw4np27WCg==" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/vue/2.7.16/vue.min.js integrity="sha512-Wx8niGbPNCD87mSuF0sBRytwW2+2ZFr7HwVDF8krCb3egstCc4oQfig+/cfg2OHd82KcUlOYxlSDAqdHqK5TCw==" crossorigin=anonymous></script>
<script>let mounted=function(){document.getElementById("search1input").addEventListener("keyup",e=>{this.txt=e.target.value,this.search()}),axios.get("https://go-vela.github.io/docs/search/index.json").then(function(e){vuesearch1.bdd=e.data.results}).catch(function(e){console.log(e)})},close=function(){setTimeout(function(){vuesearch1.showresult=!1,vuesearch1.txt=""},300)},search=function(){clearTimeout(this.timeoutID),this.timeoutID=setTimeout(this.dosearch,500)},dosearch=function(){this.result=[];let s=this.txt.split(" "),n=[];s.forEach(function(e){e&&n.push(e)});let e,t;n.forEach(function(n){if(e=vuesearch1.bdd.filter(e=>e.content.indexOf(n.toLowerCase())!==-1),vuesearch1.result.length===0){vuesearch1.result=e.slice();return}t=[],vuesearch1.result.forEach(function(n){e.forEach(function(e){n.url===e.url&&t.push(n)})}),vuesearch1.result=t.slice()}),this.result=this.result.slice(0,10),this.result=this.result.sort(function(e,t){return(""+e.display).localeCompare(t.display)}),this.showresult=this.result.length>0},vuesearch1=new Vue({el:"#search1",data:{txt:"",timeoutID:0,showresult:!1,result:{},bdd:[]},mounted,methods:{close,search,dosearch}})</script></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div><div class="search -sidebar" id=search2><input id=search2input type=text placeholder="Search site..." v-model=txt @blur=close() maxlength=50><div class=search-results :style="{'display': showresult?'block':'none'}"><a v-for="item in result" :href=item.url>{{ item.display }}</a></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js integrity="sha512-PJa3oQSLWRB7wHZ7GQ/g+qyv6r4mbuhmiDb8BjSFZ8NZ2a42oTtAq5n0ucWAwcQDlikAtkub+tPVCw4np27WCg==" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/vue/2.7.16/vue.min.js integrity="sha512-Wx8niGbPNCD87mSuF0sBRytwW2+2ZFr7HwVDF8krCb3egstCc4oQfig+/cfg2OHd82KcUlOYxlSDAqdHqK5TCw==" crossorigin=anonymous></script>
<script>let mounted_sidebar=function(){document.getElementById("search2input").addEventListener("keyup",e=>{this.txt=e.target.value,this.search()}),axios.get("https://go-vela.github.io/docs/search/index.json").then(function(e){vuesearch2.bdd=e.data.results}).catch(function(e){console.log(e)})},close_sidebar=function(){setTimeout(function(){vuesearch2.showresult=!1,vuesearch2.txt=""},300)},dosearch_sidebar=function(){this.result=[];var e,t,s=this.txt.split(" "),n=[];s.forEach(function(e){e&&n.push(e)}),n.forEach(function(n){if(e=vuesearch2.bdd.filter(e=>e.content.indexOf(n.toLowerCase())!==-1),vuesearch2.result.length===0){vuesearch2.result=e.slice();return}t=[],vuesearch2.result.forEach(function(n){e.forEach(function(e){n.url===e.url&&t.push(n)})}),vuesearch2.result=t.slice()}),this.result=this.result.slice(0,10),this.result=this.result.sort(function(e,t){return(""+e.display).localeCompare(t.display)}),this.showresult=this.result.length>0},vuesearch2=new Vue({el:"#search2",data:{txt:"",timeoutID:0,showresult:!1,result:{},bdd:[]},mounted:mounted_sidebar,methods:{close:close_sidebar,search,dosearch:dosearch_sidebar}})</script><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav pt-2 pl-4" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Installation</a></li><ul><li class="collapse show" id=docsinstallation><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/server/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Server</a></li><ul><li class="collapse show" id=docsinstallationserver><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/server/docker/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Docker</a></li><ul><li class="collapse show" id=docsinstallationserverdocker></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/server/kubernetes/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Kubernetes</a></li><ul><li class="collapse show" id=docsinstallationserverkubernetes></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/server/reference/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Reference</a></li><ul><li class="collapse show" id=docsinstallationserverreference><a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallationserverreferencesettings href=/docs/installation/server/reference/settings/>Settings</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallationserverreferencecompiler href=/docs/installation/server/reference/compiler/>Compiler</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallationserverreferencedatabase href=/docs/installation/server/reference/database/>Database</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallationserverreferencequeue href=/docs/installation/server/reference/queue/>Queue</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallationserverreferencesecret href=/docs/installation/server/reference/secret/>Secret</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallationserverreferencescm href=/docs/installation/server/reference/scm/>SCM</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallationserverreferencetoken_manager href=/docs/installation/server/reference/token_manager/>Token Manager</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-docsinstallationserverreferencetracing href=/docs/installation/server/reference/tracing/>Tracing</a></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/worker/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Worker</a></li><ul><li class="collapse show" id=docsinstallationworker><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/worker/docker/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Docker</a></li><ul><li class="collapse show" id=docsinstallationworkerdocker></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/worker/kubernetes/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Kubernetes</a></li><ul><li class="collapse show" id=docsinstallationworkerkubernetes></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/worker/reference/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Reference</a></li><ul><li class="collapse show" id=docsinstallationworkerreference><a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallationworkerreferenceexecutor href=/docs/installation/worker/reference/executor/>Executor</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallationworkerreferencequeue href=/docs/installation/worker/reference/queue/>Queue</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallationworkerreferenceruntime href=/docs/installation/worker/reference/runtime/>Runtime</a></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/ui/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">UI</a></li><ul><li class="collapse show" id=docsinstallationui><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/ui/docker/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Docker</a></li><ul><li class="collapse show" id=docsinstallationuidocker></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/ui/kubernetes/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Kubernetes</a></li><ul><li class="collapse show" id=docsinstallationuikubernetes></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/installation/ui/reference/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Reference</a></li><ul><li class="collapse show" id=docsinstallationuireference></li></ul></ul></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/go-vela/docs/edit/main/content/installation/server/reference/tracing.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/go-vela/docs/issues/new?title=Tracing" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a></div><nav id=TableOfContents><ul><li><a href=#configuration>Configuration</a></li><li><a href=#exporter>Exporter</a></li><li><a href=#sampling>Sampling</a><ul><li><a href=#shared-samplers>&ldquo;Shared&rdquo; Samplers</a></li><li><a href=#task-samplers>&ldquo;Task&rdquo; Samplers</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://go-vela.github.io/docs/installation/>Installation</a></li><li class=breadcrumb-item><a href=https://go-vela.github.io/docs/installation/server/>Server</a></li><li class=breadcrumb-item><a href=https://go-vela.github.io/docs/installation/server/reference/>Reference</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://go-vela.github.io/docs/installation/server/reference/tracing/>Tracing</a></li></ol></nav><div class=td-content><h1>Tracing</h1><div class=lead>This section contains information on configuring OpenTelemetry instrumentation for the Vela server.</div><p>This component is responsible for instrumenting <a href=https://opentelemetry.io/docs/concepts/signals/traces/>OpenTelemetry traces</a> based off the configuration provided.</p><h2 id=configuration>Configuration</h2><p>The following options are used to configure the component:</p><table><thead><tr><th>Name</th><th>Description</th><th>Required</th><th>Default</th><th>Environment Variables</th></tr></thead><tbody><tr><td><code>tracing.enable</code></td><td>This variable enables <a href=https://opentelemetry.io/docs/concepts/signals/traces/>OpenTelemetry tracing</a> for the Vela server. You must provide <code>VELA_OTEL_EXPORTER_OTLP_ENDPOINT</code> <strong>when tracing is enabled</strong>.</td><td><code>false</code></td><td><code>false</code></td><td><code>VELA_OTEL_TRACING_ENABLE</code></td></tr><tr><td><code>tracing.service.name</code></td><td>This variable sets the <a href=https://opentelemetry.io/docs/languages/sdk-configuration/general/>service name</a> applied to <a href=https://opentelemetry.io/docs/concepts/signals/traces/>traces</a>.</td><td><code>false</code></td><td><code>vela-server</code></td><td><code>VELA_OTEL_TRACING_SERVICE_NAME</code></td></tr><tr><td><code>tracing.exporter.endpoint</code></td><td>This variable sets the <a href=https://opentelemetry.io/docs/languages/sdk-configuration/otlp-exporter/>OTel exporter</a> endpoint (ex. scheme://host:port).</td><td><code>false</code></td><td><code>N/A</code></td><td><code>VELA_OTEL_EXPORTER_OTLP_ENDPOINT</code></td></tr><tr><td><code>tracing.exporter.cert_path</code></td><td>This variable sets the path to certs used for communicating with the <a href=https://opentelemetry.io/docs/specs/OTel/protocol/exporter/>OTel exporter</a>. If nothing is provided the server will use insecure communication.</td><td><code>false</code></td><td><code>N/A</code></td><td><code>VELA_OTEL_TRACING_EXPORTER_SSL_CERT_PATH</code></td></tr><tr><td><code>tracing.exporter.tls-min-version</code></td><td>This optional variable sets a TLS minimum version used when exporting traces to the <a href=https://opentelemetry.io/docs/specs/OTel/protocol/exporter/>OTel exporter</a>.</td><td><code>false</code></td><td><code>1.2</code></td><td><code>VELA_OTEL_TRACING_TLS_MIN_VERSION</code></td></tr><tr><td><code>tracing.sampler.persecond</code></td><td>This variable sets OTel <a href=https://opentelemetry.io/docs/concepts/sampling/>tracing head-sampler</a> rate-limiting to N per second.</td><td><code>false</code></td><td><code>100</code></td><td><code>VELA_OTEL_TRACING_SAMPLER_RATELIMIT_PER_SECOND</code></td></tr><tr><td><code>tracing.sampler.tasks</code></td><td>This variable sets an (optional) filepath to the OTel tracing head-sampler configurations json to alter how certain tasks (API endpoints, queries, etc) are sampled.</td><td><code>false</code></td><td><code>N/A</code></td><td><code>VELA_OTEL_TRACING_SAMPLER_TASKS_CONFIG_FILEPATH</code></td></tr><tr><td><code>tracing.resource.attributes</code></td><td>This variable sets OTel resource <a href=https://opentelemetry.io/docs/languages/go/instrumentation/#span-attributes>(span) attributes</a> as a list of <code>key=value</code> pairs. each one will be attached to each span as a &lsquo;process&rsquo; attribute.</td><td><code>false</code></td><td><code>N/A</code></td><td><code>VELA_OTEL_TRACING_RESOURCE_ATTRIBUTES</code></td></tr><tr><td><code>tracing.resource.env_attributes</code></td><td>This variable sets OTel resource <a href=https://opentelemetry.io/docs/languages/go/instrumentation/#span-attributes>(span) attributes</a> as a list of <code>key=env_variable_key</code> pairs. each one will be attached to each <a href=https://opentelemetry.io/docs/languages/go/instrumentation/#span-attributes>span</a> as a &lsquo;process&rsquo; attribute where the value is retrieved from the environment using the pair value.</td><td><code>false</code></td><td><code>N/A</code></td><td><code>VELA_OTEL_TRACING_RESOURCE_ENV_ATTRIBUTES</code></td></tr><tr><td><code>tracing.span.attributes</code></td><td>This variable sets trace <a href=https://opentelemetry.io/docs/languages/go/instrumentation/#span-attributes>span attributes</a> as a list of <code>key=value</code> pairs. Each pair will be attached to each <a href=https://opentelemetry.io/docs/languages/go/instrumentation/#span-attributes>span</a> as a &rsquo;tag&rsquo; attribute.</td><td><code>false</code></td><td><code>N/A</code></td><td><code>VELA_OTEL_TRACING_SPAN_ATTRIBUTES</code></td></tr><tr><td><code>tracing.tracestate.attributes</code></td><td>This variable sets OTel tracestate <a href=https://www.w3.org/TR/trace-context>(span) attributes</a> as a list of <code>key=value</code> pairs. Each pair will be inserted into the tracestate for each sampled span.</td><td><code>false</code></td><td><code>N/A</code></td><td><code>VELA_OTEL_TRACING_TRACESTATE_ATTRIBUTES</code></td></tr></tbody></table><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note:</h4>For more information on how the runtime properties are consumed, please see the <a href=/docs/installation/server/reference/>server reference</a>.</div><h2 id=exporter>Exporter</h2><p>To start using tracing you first need to set <code>VELA_OTEL_TRACING_ENABLE=true</code> in the runtime environment.</p><p>Enabling tracing requires that <code>VELA_OTEL_EXPORTER_OTLP_ENDPOINT</code> be set to an <a href=https://opentelemetry.io/docs/specs/OTel/protocol/exporter/>exporter</a> host that is reachable over HTTP.</p><p>If the exporter requires SSL then <code>VELA_OTEL_TRACING_EXPORTER_SSL_CERT_PATH</code> must be set to a filepath that contains valid certificates. If no certificate filepath is set, then the server will communicate with the exporter over HTTP (insecure).</p><p>The Vela local stack is configured to export traces to Jaeger using their &ldquo;all-in-one&rdquo; Docker image, making it easy to view traces out of the box.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#00a000>+   jaeger:
</span></span></span><span style=display:flex><span><span style=color:#00a000>+     image: jaegertracing/all-in-one:latest
</span></span></span><span style=display:flex><span><span style=color:#00a000></span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ docker run \
</span></span><span style=display:flex><span>  --detach=true \
</span></span><span style=display:flex><span>  --env=VELA_ADDR=https://vela-server.example.com \
</span></span><span style=display:flex><span><span style=color:#00a000>+ --env=VELA_OTEL_TRACING_ENABLE: true \
</span></span></span><span style=display:flex><span><span style=color:#00a000>+ --env=VELA_OTEL_EXPORTER_OTLP_ENDPOINT: http://jaeger:4318 \
</span></span></span><span style=display:flex><span><span style=color:#00a000></span>...
</span></span></code></pre></div><p>From the <a href=https://www.jaegertracing.io/docs/1.6/getting-started/>Jaeger official website</a>:</p><blockquote><p>This image, designed for quick local testing, launches the Jaeger UI, collector, query, and agent, with an in memory storage component.</p></blockquote><h2 id=sampling>Sampling</h2><p>The server uses a combination of &ldquo;shared&rdquo; and &ldquo;per-task&rdquo; <a href=https://opentelemetry.io/docs/concepts/sampling/>head sampling</a> to control how traces are recorded or dropped.</p><h3 id=shared-samplers>&ldquo;Shared&rdquo; Samplers</h3><p>The following samplers are utilized by all traces produced by the server.</p><h4 id=global-rate-limiting>Global Rate-limiting</h4><p>All traces share a global rate limit controlled by <code>VELA_OTEL_TRACING_SAMPLER_RATELIMIT_PER_SECOND</code>.</p><p>Use <code>VELA_OTEL_TRACING_SAMPLER_RATELIMIT_PER_SECOND</code> to set a maximum threshold of &ldquo;N traces per second&rdquo;. The default is <code>100</code> traces per second.</p><h3 id=task-samplers>&ldquo;Task&rdquo; Samplers</h3><p>Set <code>VELA_OTEL_TRACING_SAMPLER_TASKS_CONFIG_FILEPATH</code> to point to a JSON filepath to control sampler configurations on a per-task basis.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#a40000>tracing.json</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;task-name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;active&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#a40000>bool</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>A <code>task</code> is basically the &ldquo;span name&rdquo; based on the work being performed. A <code>task</code> can be an API endpoint interaction, a <a href=https://gorm.io/docs/index.html>Gorm</a> query, etc. See <a href=https://opentelemetry.io/docs/specs/otel/trace/api/#span>OTel span docs</a> for more information.</p><p>If a <code>task</code> is <strong>not</strong> represented in the configuration file then the task will be treated normally, <strong>with tracing enabled</strong> using the &ldquo;shared&rdquo; samplers.</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>active</code></td><td>bool</td><td>Set to <code>false</code> to completely disable traces for a particular task.</td></tr></tbody></table><p>Examples of trace tasks include API endpoints, gorm queries, etc. The list of tasks will change as functionality is added to the server.</p><blockquote><p>See the configuration file examples below.</p></blockquote><h4 id=example---no-tasks>Example - No Tasks</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{}</span>
</span></span></code></pre></div><p>Because tasks that do not exist in the configuration file will be treated as enabled, this file will <strong>enable all tracing</strong>.</p><h4 id=example---disable-health-endpoint>Example - Disable /health Endpoint</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;/health&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;active&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Because <code>active</code> can be used to disable tracing, this configuration file will enable tracing for all tasks <strong>except for the <code>/health</code> endpoint</strong>.</p><h4 id=example---mixed-tasks>Example - Mixed Tasks</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;/health&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;active&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;/api/v1/deployments/:org/:repo&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;active&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;/api/v1/:worker&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;active&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>true</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;gorm.query&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;active&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The task <code>/health</code> with <code>active: false</code> will <strong>disable</strong> tracing on <code>/health</code>.</p><p><code>/api/v1/deployments/:org/:repo</code> with <code>active: false</code> will <strong>disable</strong> tracing on <code>/api/v1/deployments/:org/:repo</code> for <strong>ALL</strong> <code>:org</code> and <code>:repo</code> parameters.</p><p><code>/api/v1/:worker</code> with <code>active: true</code> <strong>will do nothing</strong> at this point, because any tasks that are not present in the configuration file will automatically be sampled normally. For now this is slightly confusing, but in the future there will be more configuration fields that will determine how an <code>active: true</code> task is sampled.</p><p>The task <code>gorm.query</code> with <code>active: false</code> would disable tracing for raw gorm queries. This is meant to show that the config applies to <strong>all trace tasks</strong> and not just API endpoints.</p><p><strong>All other tasks</strong> will be sampled as normal using the global shared samplers (like rate limiting)! This includes all API endpoints and gorm queries.</p><div class="text-muted mt-5 pt-3 border-top">Last modified October 2, 2024: <a href=https://github.com/go-vela/docs/commit/9623a0f15f0bbbadf2c642bb2f591436cb654719>feat: otel tracing (#427) (9623a0f1)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/go-vela><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank href="https://gophers.slack.com/app_redirect?channel=CNRRKE8KY"><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank href=mailto:vela@target.com><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 Target Brands All Rights Reserved</small>
<small class=ml-1><a href=https://github.com/go-vela/server/blob/main/LICENSE target=_blank>Privacy Policy</a></small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.8/umd/popper.min.js integrity="sha512-TPh2Oxlg1zp+kz3nFA0C5vVC6leG/6mm1z9+mA81MI5eaUVqasPLO8Cuk4gMF4gUfP5etR73rgU/8PNMsSesoQ==" crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<script src=/docs/js/main.min.7a71bafd3fa8b6fc0a69d44088ed34c9fad67cd3fa093a1f02a9fa6850b16a1c.js integrity="sha256-enG6/T+otvwKadRAiO00yfrWfNP6CTofAqn6aFCxahw=" crossorigin=anonymous></script></body></html>